// Sample chat history array
const chathistory = [
  {
    content: "This is a message from the user.3",
    sender: "user",
    _id: "67208fc2adc4215255c7b94e",
  },
  {
    content: "This is a message from the model.3",
    sender: "model",
    _id: "67208fc2adc4215255c7b94f",
  },
  {
    content: "hello",
    sender: "user",
    _id: "6721de0680f06301f6f10ec8",
  },
  {
    content: "Hello! How can I help you today?",
    sender: "model",
    _id: "6721de0680f06301f6f10ec9",
  },
  {
    content: "cho tôi đoạn code js ngắn cộng 2 số",
    sender: "user",
    _id: "6721de1c80f06301f6f10ed4",
  },
  {
    content: "Hello! How can I help you today?",
    sender: "model",
    _id: "6721de0680f06301f6f10ec9",
  },
  {
    content: "cho tôi đoạn code js ngắn cộng 2 số",
    sender: "user",
    _id: "6721de1c80f06301f6f10ed4",
  },
  {
    content: "Hello! How can I help you today?",
    sender: "model",
    _id: "6721de0680f06301f6f10ec9",
  },
  {
    content: "cho tôi đoạn code js ngắn cộng 2 số",
    sender: "user",
    _id: "6721de1c80f06301f6f10ed4",
  },
  {
    content: "Hello! How can I help you today?",
    sender: "model",
    _id: "6721de0680f06301f6f10ec9",
  },
  {
    content: "cho tôi đoạn code js ngắn cộng 2 số",
    sender: "user",
    _id: "6721de1c80f06301f6f10ed4",
  },
  {
    content: "Hello! How can I help you today?",
    sender: "model",
    _id: "6721de0680f06301f6f10ec9",
  },
  {
    content: "cho tôi đoạn code js ngắn cộng 2 số",
    sender: "user",
    _id: "6721de1c80f06301f6f10ed4",
  },
  {
    content: "Hello! How can I help you today?",
    sender: "model",
    _id: "6721de0680f06301f6f10ec9",
  },
  {
    content: "cho tôi đoạn code js ngắn cộng 2 số",
    sender: "user",
    _id: "6721de1c80f06301f6f10ed4",
  },
  {
    content: "Hello! How can I help you today?",
    sender: "model",
    _id: "6721de0680f06301f6f10ec9",
  },
  {
    content: "cho tôi đoạn code js ngắn cộng 2 số",
    sender: "user",
    _id: "6721de1c80f06301f6f10ed4",
  },
  {
    content: "Hello! How can I help you today?",
    sender: "model",
    _id: "6721de0680f06301f6f10ec9",
  },
  {
    content:
      "cho tôi đoạn code js ngắn cộcho tôi đoạn code js ngắn cộng 2 sốcho tôi đoạn code js ngắn cộng 2 sốcho tôi đoạn code js ngắn cộng 2 sốcho tôi đoạn code js ngắn cộng 2 sốcho tôi đoạn code js ngắn cộng 2 sốcho tôi đoạn code js ngắn cộng 2 sốcho tôi đoạn code js ngắn cộng 2 sốcho tôi đoạn code js ngắn cộng 2 sốcho tôi đoạn code js ngắn cộng 2 sốcho tôi đoạn code js ngắn cộng 2 sốcho tôi đoạn code js ngắn cộng 2 sốcho tôi đoạn code js ngắn cộng 2 sống 2 số",
    sender: "user",
    _id: "6721de1c80f06301f6f10ed4",
  },
  {
    content:
      "Hello! How can I help you todayello! How can I help you todayello! How can I help you todayello! How can I help you todayello! How can I help you todayello! How can I help you todayello! How can I help you todayello! How can I help you todayello! How can I help you todayello! How can I help you today?",
    sender: "model",
    _id: "6721de0680f06301f6f10ec9",
  },
];

const chatSessions = [
  {
    _id: "6721a712fda5480a74c5f8fb",
    name: "cai nay rat la daiiiiiiiiiiiiiiiiiiiiiiixxxxxxxxxxxxxxyyyyyyyyyyxx",
    lastChatTime: "2024-10-31T07:21:29.422Z",
  },
  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },
  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },
  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },
  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },
  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },
  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },
  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },
  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },
  {
    _id: "6722fca9846d19e5083fe5c9",
    name: "xin chào",
    lastChatTime: "2024-10-31T04:29:02.287Z",
  },

  // (include other session data here)
];

// Populate chat sessions in sidebar
function loadChatSessions() {
  const chatSessionsContainer = document.getElementById("chat-sessions");
  chatSessionsContainer.innerHTML = ""; // Clear existing sessions
  chatSessions.forEach((session) => {
    const sessionElement = document.createElement("div");

    // Create chat session name
    const nameElement = document.createElement("li");
    nameElement.textContent = session.name;
    nameElement.title = session.name; // Tooltip for full name on hover
    nameElement.onclick = () => {
      // Redirect to the same page with ?id={_id}
      window.location.href = `${window.location.pathname}?id=${session._id}`;
    };

    // Create button
    const buttonElement = document.createElement("button");
    buttonElement.textContent = "...";
    buttonElement.style.cursor = "pointer";
    buttonElement.onclick = (e) => {
      e.stopPropagation(); // Prevent the click from triggering the session click
      showContextMenu(e, session._id);
    };

    // Append elements to session
    sessionElement.appendChild(nameElement);
    sessionElement.appendChild(buttonElement);
    chatSessionsContainer.appendChild(sessionElement);
  });
}

// Function to show context menu
function showContextMenu(event, sessionId) {
  // Remove any existing context menu
  const existingMenu = document.querySelector(".context-menu");
  if (existingMenu) {
    existingMenu.remove();
  }

  // Create a new context menu
  const contextMenu = document.createElement("div");
  contextMenu.className = "context-menu"; // Add a class for styling
  contextMenu.style.position = "absolute";
  contextMenu.style.top = `${event.clientY}px`;
  contextMenu.style.left = `${event.clientX}px`;
  contextMenu.innerHTML = `
        <div class="context-menu-item" onclick="renameChatSession('${sessionId}')">
            <i class="fa fa-pencil"></i> Rename
        </div>
        <div style="color: red;" class="context-menu-item" onclick="deleteChatSession('${sessionId}')">
            <i class="fa fa-trash-o"  style="color: red;"></i> <p>Delete</p>
        </div>
    `;

  // Append context menu to body
  document.body.appendChild(contextMenu);

  // Remove context menu on click outside
  document.addEventListener(
    "click",
    () => {
      contextMenu.remove();
    },
    { once: true }
  );

  // Prevent the context menu from closing immediately when clicking inside it
  event.stopPropagation();
}

// Function to handle renaming a chat session
function renameChatSession(sessionId) {
  const session = chatSessions.find((s) => s._id === sessionId);
  const newName = prompt("Enter new name for the chat session:", session.name);
  if (newName) {
    session.name = newName; // Update the session name
    loadChatSessions(); // Refresh the chat sessions display
  }
}

// Function to handle deleting a chat session
function deleteChatSession(sessionId) {
  const sessionIndex = chatSessions.findIndex((s) => s._id === sessionId);
  if (sessionIndex > -1) {
    if (confirm("Are you sure you want to delete this chat session?")) {
      chatSessions.splice(sessionIndex, 1); // Remove the session from the array
      loadChatSessions(); // Refresh the chat sessions display
    }
  }
}

// Select the chat messages container
const chatMessages = document.getElementById("chat-messages");

// Function to load and display chat history
function loadChatHistory() {
  chathistory.forEach((message) => {
    addMessage(message.sender, message.content);
  });
}
function handleEnter(event) {
  if (event.key === "Enter") {
    sendMessage();
  }
}

function sendMessage() {
  const message = document.getElementById("user-input").value;
  if (message) {
    console.log("Message sent:", message);
    document.getElementById("user-input").value = "";
  }
}

// Function to add a message to the chat area
function addMessage(sender, messageText) {
  const messageElement = document.createElement("div");
  messageElement.classList.add("chat-message", sender);
  messageElement.textContent = messageText;
  chatMessages.appendChild(messageElement);
  chatMessages.scrollTop = chatMessages.scrollHeight; // Auto-scroll to the bottom
}
function handleProfileClick() {
  alert("Profile icon clicked!");
}

// Function to send a message
function sendMessage() {
  const input = document.getElementById("user-input");
  const messageText = input.value.trim();

  if (messageText) {
    // Display user message
    addMessage("user", messageText);

    // Clear input field
    input.value = "";

    // Simulate AI response (you can replace this with real response from backend)
    setTimeout(
      () => addMessage("model", "This is a simulated AI response."),
      1000
    );
  }
}

// Load chat history on page load
// Load chat sessions on page load
window.onload = () => {
  loadChatSessions();
  loadChatHistory(); // Loads initial chat history if desired
};

function toggleSidebar() {
  const sidebar = document.getElementById("sidebar");
  const inputChat = document.getElementById("chat-input");
  // Toggle the display style between 'none' and 'block'
  if (sidebar.style.display === "none" || sidebar.style.display === "") {
    sidebar.style.display = "block"; // Show the sidebar
    inputChat.style.left = "10%";
  } else {
    sidebar.style.display = "none"; // Hide the sidebar
    inputChat.style.left = "";
  }
}

function startNewChat() {
  window.location.href = "chat.html";
}

// Select the search input by its ID
const searchInput = document.getElementById("searchInput");

// Add an event listener for keydown event
searchInput.addEventListener("keydown", function (event) {
  // Check if the Enter key was pressed
  if (event.key === "Enter") {
    // Prevent the default behavior (if necessary)
    event.preventDefault();

    // Get the value of the input
    const searchQuery = searchInput.value.trim();

    // Trigger the search function or handle the search query
    if (searchQuery) {
      performSearch(searchQuery);
    }
  }
});

// Example function to handle the search
function performSearch(query) {
  console.log(`Searching for: ${query}`);
  // Add your search functionality here
  // e.g., sending a request to the server or filtering results
}
